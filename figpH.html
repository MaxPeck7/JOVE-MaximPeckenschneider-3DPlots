
<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Simulated pH</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link rel="preconnect" href="https://cdn.plot.ly">
  <script src="https://cdn.plot.ly/plotly-gl3d-latest.min.js" defer></script>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 16px; }
    #plot { width: 100%; max-width: 900px; height: 70vh; margin: 24px auto; }
    .skeleton { background: repeating-linear-gradient(90deg,#eee,#eee 10px,#f5f5f5 10px,#f5f5f5 20px); }
  </style>
</head>
<body>
  <h1>Simulated pH</h1>
  <div id="plot" class="skeleton" aria-busy="true"></div>

  <script>
  const el = document.getElementById("plot");
  let started = false;

  function waitForPlotly() {
    return new Promise((resolve) => {
      if (window.Plotly) return resolve();
      const iv = setInterval(() => {
        if (window.Plotly) { clearInterval(iv); resolve(); }
      }, 50);
    });
  }

  async function render() {
    if (started) return;
    started = true;
    try {
      await waitForPlotly();

      // Fetch the figure JSON from the same folder
      const resp = await fetch("figpH.json", { cache: "reload" });
      if (!resp.ok) throw new Error("Could not load figpH.json");
      const fig = await resp.json();

      await Plotly.newPlot(el, fig.data, fig.layout, { responsive: true });
      el.classList.remove("skeleton");
    } catch (err) {
      console.error("Render error:", err);
      el.classList.remove("skeleton");
      el.innerHTML = "<p style='text-align:center'>Could not load the plot. Open the console for details.</p>";
    }
  }

  // Lazy-load when near viewport (or just call render() directly if you prefer)
  const obs = new IntersectionObserver((entries) => {
    if (entries.some(e => e.isIntersecting)) {
      render();
      obs.disconnect();
    }
  }, { rootMargin: "200px" });

  obs.observe(el);
</script>
</body>
</html>
